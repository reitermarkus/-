#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/golfmoji'

require 'optparse'
require 'unicode'

input_file = STDIN

begin
  OptionParser.new { |opts|
    opts.on('-f FILE', 'Input file') do |f|
      input_file = File.new(f, 'r:UTF-8')
    end
  }.parse!
rescue => e
  STDERR.puts e
  exit 1
end

if input_file == STDIN && input_file.tty?
  STDERR.puts 'Cannot read from standard input because it is a TTY.'
  exit 1
end

input = input_file.read.strip
instructions = Unicode.text_elements(input)

print Golfmoji::Executor.new(instructions, ARGV).execute
print "\n"
